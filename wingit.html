<!DOCTYPE html>
<html>
<head>
    <title>Wingit Cost Estimator: Hetzner vs AWS</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; background: #f5f5f7; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; background: #f9f9f9; padding: 20px; border-radius: 8px; }
        .slider-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input[type=range] { width: 100%; }
        .val-display { float: right; color: #007aff; font-weight: bold; }
        .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; text-align: center; }
        .metric-card { padding: 15px; background: #f0f2f5; border-radius: 8px; }
        .metric-val { font-size: 24px; font-weight: 800; margin-top: 5px; }
        .h-val { color: #d63031; } /* Hetzner color */
        .a-val { color: #ff9f43; } /* AWS color */
        small { color: #666; font-size: 11px; display: block; margin-top: 5px;}
    </style>
</head>
<body>

<div class="container">
    <h2>Wingit Infrastructure Scalability Model</h2>
    
    <div class="controls">
        <div>
            <div class="slider-group">
                <label>Concurrent Users <span id="usersVal" class="val-display">50</span></label>
                <input type="range" id="users" min="10" max="2000" value="50" step="10">
            </div>
            <div class="slider-group">
                <label>Hours per User / Month <span id="hoursVal" class="val-display">5</span></label>
                <input type="range" id="hours" min="1" max="40" value="5">
            </div>
        </div>
        <div>
            <div class="slider-group">
                <label>ASR Cost ($/min) <span id="asrVal" class="val-display">$0.0043</span></label>
                <input type="range" id="asr" min="0.001" max="0.01" value="0.0043" step="0.0001">
                <small>Deepgram Nova-2 is ~$0.0043. Bulk rate drops to $0.003.</small>
            </div>
            <div class="slider-group">
                <label>LLM Cost ($/hour) <span id="llmVal" class="val-display">$0.05</span></label>
                <input type="range" id="llm" min="0.01" max="0.50" value="0.05" step="0.01">
                <small>GPT-4o-mini buffered.</small>
            </div>
        </div>
    </div>

    <canvas id="costChart" width="800" height="400"></canvas>

    <div class="metrics">
        <div class="metric-card">
            <div>Variable Cost (API)</div>
            <div id="varCost" class="metric-val">$0</div>
            <small>ASR + LLM (Same for both)</small>
        </div>
        <div class="metric-card">
            <div>Total Monthly (Hetzner)</div>
            <div id="hetznerTotal" class="metric-val h-val">$0</div>
            <small>Single VPS -> Dedicated Cluster</small>
        </div>
        <div class="metric-card">
            <div>Total Monthly (AWS)</div>
            <div id="awsTotal" class="metric-val a-val">$0</div>
            <small>Fargate, RDS, ALB, NAT, Egress</small>
        </div>
    </div>
</div>

<script>
const ctx = document.getElementById('costChart').getContext('2d');
let chart;

function calculate() {
    const users = parseInt(document.getElementById('users').value);
    const hours = parseInt(document.getElementById('hours').value);
    const asrRate = parseFloat(document.getElementById('asr').value);
    const llmRate = parseFloat(document.getElementById('llm').value);

    // Update displays
    document.getElementById('usersVal').innerText = users;
    document.getElementById('hoursVal').innerText = hours;
    document.getElementById('asrVal').innerText = '$' + asrRate.toFixed(4);
    document.getElementById('llmVal').innerText = '$' + llmRate.toFixed(2);

    // 1. Variable Costs (Per User Per Month)
    // ASR: Users * Hours * 60 mins * Rate
    // LLM: Users * Hours * Rate
    const totalMinutes = users * hours * 60;
    const asrCost = totalMinutes * asrRate;
    const llmCost = (users * hours) * llmRate;
    const variableCost = asrCost + llmCost;

    // 2. Hetzner Fixed Costs (Step Function)
    // < 100 users: CPX31 ($15) + DB ($10) = $25
    // < 500 users: CPX51 ($60) + DB ($20) = $80
    // < 2000 users: Dedicated AX102 ($120) + DB ($40) = $160
    let hetznerFixed = 0;
    if (users < 100) hetznerFixed = 25;
    else if (users < 500) hetznerFixed = 80;
    else hetznerFixed = 160;

    // 3. AWS Fixed/Elastic Costs
    // Base: ALB ($20) + NAT ($35) + RDS ($50) + ElastiCache ($40) = $145 base
    // Compute: Fargate ($40 per 100 users - scaling)
    // Data Transfer: ~$0.09/GB. Approx 0.05GB per user/hour audio upstream + websockets
    const awsBase = 145; 
    const awsCompute = Math.ceil(users / 100) * 40; 
    const dataGB = (users * hours * 0.05);
    const awsEgress = dataGB * 0.09;
    
    const hetznerTotal = variableCost + hetznerFixed;
    const awsTotal = variableCost + awsBase + awsCompute + awsEgress;

    document.getElementById('varCost').innerText = '$' + Math.round(variableCost).toLocaleString();
    document.getElementById('hetznerTotal').innerText = '$' + Math.round(hetznerTotal).toLocaleString();
    document.getElementById('awsTotal').innerText = '$' + Math.round(awsTotal).toLocaleString();

    return { hetznerTotal, awsTotal, variableCost };
}

function updateChart() {
    const data = calculate();
    const currentUsers = parseInt(document.getElementById('users').value);
    
    // Generate projection points
    const points = [50, 250, 500, 1000, 2000];
    const hData = [];
    const aData = [];
    
    const hours = parseInt(document.getElementById('hours').value);
    const asrRate = parseFloat(document.getElementById('asr').value);
    const llmRate = parseFloat(document.getElementById('llm').value);

    points.forEach(u => {
        const totalMins = u * hours * 60;
        const vCost = (totalMins * asrRate) + (u * hours * llmRate);
        
        // Hetzner Projection
        let hFixed = u < 100 ? 25 : (u < 500 ? 80 : 160);
        hData.push(vCost + hFixed);

        // AWS Projection
        let aBase = 145 + (Math.ceil(u / 100) * 40) + ((u * hours * 0.05) * 0.09);
        aData.push(vCost + aBase);
    });

    chart.data.labels = points.map(p => p + ' Users');
    chart.data.datasets[0].data = hData;
    chart.data.datasets[1].data = aData;
    chart.update();
}

// Init Chart
window.onload = function() {
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [{
                label: 'Hetzner (VPS)',
                borderColor: '#d63031',
                data: [],
                fill: false
            }, {
                label: 'AWS (Managed)',
                borderColor: '#ff9f43',
                data: [],
                fill: false
            }]
        },
        options: {
            responsive: true,
            interaction: { mode: 'index', intersect: false },
            scales: {
                y: { title: { display: true, text: 'Monthly Cost ($)' } }
            }
        }
    });
    
    document.querySelectorAll('input').forEach(i => i.addEventListener('input', updateChart));
    updateChart();
};
</script>
</body>
</html>

